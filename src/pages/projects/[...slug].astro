---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((entry: CollectionEntry<"projects">) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<"projects">;
};

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
  <div class="animate-fade-in">
    <div class="mb-12 border-b border-white/5 pb-8">
      <div
        class="flex items-center gap-2 text-xs font-mono text-gray-500 mb-6 tracking-widest uppercase"
      >
        <a href="/projects" class="hover:text-accent transition-colors"
          >[DIR: PROJECTS]</a
        >
        <span class="text-accent">/</span>
        <span class="text-gray-300">FILE: {entry.data.title}</span>
      </div>

      <h1
        class="text-4xl sm:text-5xl font-black uppercase tracking-widest font-mono text-gray-100 mb-6 leading-none"
      >
        {entry.data.title}
      </h1>

      <p
        class="text-lg text-gray-400 font-mono leading-relaxed mb-8 max-w-2xl border-l border-white/10 pl-4 ml-1"
      >
        // {entry.data.description}
      </p>

      <div class="flex flex-wrap items-center gap-6">
        <div class="flex flex-wrap gap-2">
          {
            entry.data.tags.map((tag: string) => (
              <span class="px-3 py-1 text-xs font-mono font-bold text-accent border border-accent/30 bg-accent/5 uppercase tracking-wider hover:bg-accent/10 transition-colors">
                {tag}
              </span>
            ))
          }
        </div>

        {
          entry.data.link && (
            <div class="w-px h-6 bg-white/10 hidden sm:block" />
          )
        }

        {
          entry.data.link && (
            <a
              href={entry.data.link}
              target="_blank"
              class="group inline-flex items-center gap-2 text-xs font-mono font-bold text-gray-400 hover:text-accent uppercase tracking-widest"
            >
              [ VIEW_SOURCE ]
              <span class="opacity-50 group-hover:opacity-100 transition-opacity">
                â†—
              </span>
            </a>
          )
        }
      </div>
    </div>

    {
      entry.data.image && (
        <div class="mb-16 relative group">
          <div class="absolute -top-2 -left-2 w-4 h-4 border-t border-l border-white/20 group-hover:border-accent transition-colors" />
          <div class="absolute -bottom-2 -right-2 w-4 h-4 border-b border-r border-white/20 group-hover:border-accent transition-colors" />

          <div class="w-full aspect-video bg-surface-dark overflow-hidden relative border border-white/5">
            <img
              src={entry.data.image}
              alt={entry.data.title}
              class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"
            />
          </div>
        </div>
      )
    }

    <article
      class="prose prose-invert max-w-none
      
      prose-p:text-gray-400 prose-p:font-mono prose-p:leading-7 prose-p:text-sm
      prose-li:text-gray-400 prose-li:font-mono prose-li:text-sm
      
      prose-headings:font-mono prose-headings:uppercase prose-headings:tracking-widest prose-headings:text-gray-100
      
      prose-h2:text-xl prose-h2:font-bold prose-h2:mt-12 prose-h2:mb-6
      prose-h2:border-l-4 prose-h2:border-accent prose-h2:pl-4
      prose-h2:flex prose-h2:items-center
      
      prose-a:text-accent prose-a:no-underline hover:prose-a:underline hover:prose-a:text-accent-hover
      
      prose-img:rounded-none prose-img:border prose-img:border-white/10
      
      prose-strong:text-gray-100 prose-strong:font-bold"
    >
      <Content />
    </article>

    <div
      class="mt-16 pt-8 border-t border-white/5 flex justify-between text-xs font-mono text-gray-600"
    >
      <a href="/projects" class="hover:text-accent transition-colors"
        >{"<"} BACK_TO_LIST</a
      >
      <span>END_OF_FILE</span>
    </div>
  </div>
</Layout>
