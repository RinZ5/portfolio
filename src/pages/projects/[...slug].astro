---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((entry: CollectionEntry<"projects">) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<"projects">;
};

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title}>
  <main class="max-w-3xl mx-auto px-4 sm:px-6 md:px-8">
    <div class="mb-10">
      <h1
        class="text-3xl sm:text-4xl font-bold mb-4 tracking-tight font-mplus text-gray-900 dark:text-gray-100"
      >
        <a
          href="/projects"
          class="text-gray-400 dark:text-gray-500 hover:text-gray-900 dark:hover:text-white transition-colors cursor-pointer"
        >
          Projects
        </a>
        <span class="mx-2 text-gray-300 dark:text-gray-700">/</span>
        {entry.data.title}
      </h1>

      <p
        class="text-lg text-gray-600 dark:text-gray-300 leading-relaxed mb-6 max-w-2xl"
      >
        {entry.data.description}
      </p>

      <div class="flex flex-wrap items-center gap-4">
        <div class="flex flex-wrap gap-2">
          {
            entry.data.tags.map((tag: string) => (
              <span class="px-2 py-1 text-xs font-bold rounded-md bg-accent/10 text-accent border border-accent/20">
                {tag}
              </span>
            ))
          }
        </div>

        {
          entry.data.link && (
            <span class="hidden sm:inline text-gray-300 dark:text-gray-700">
              •
            </span>
          )
        }

        {
          entry.data.link && (
            <a
              href={entry.data.link}
              target="_blank"
              class="inline-flex items-center gap-1 text-sm font-bold text-accent hover:underline underline-offset-4"
            >
              View Source <span class="text-xs">↗</span>
            </a>
          )
        }
      </div>
    </div>

    {
      entry.data.image && (
        <div class="mb-12 rounded-xl overflow-hidden shadow-lg border border-white/10 bg-surface-dark">
          <img
            src={entry.data.image}
            alt={entry.data.title}
            class="w-full aspect-video object-cover"
          />
        </div>
      )
    }

    <article
      class="prose dark:prose-invert max-w-none font-mplus
      prose-h2:text-xl prose-h2:font-bold prose-h2:mb-4 prose-h2:mt-8
      prose-h2:flex prose-h2:items-center
      prose-h2:before:content-['#'] prose-h2:before:text-accent/50 prose-h2:before:mr-2 prose-h2:before:font-normal
      prose-p:text-gray-300 prose-p:leading-relaxed prose-p:mb-6
      prose-li:text-gray-300
      prose-a:text-accent hover:prose-a:text-accent-hover
      prose-img:rounded-lg prose-img:my-8"
    >
      <Content />
    </article>
  </main>
</Layout>
